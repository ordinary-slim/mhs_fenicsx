# BEG_ESSENTIAL
isSteady: False
radius : &radius 0.05
half_radius : &half_radius 0.025
source_terms :
  - initial_position : [0.0, 0.0, 0.0]
    initial_speed : &speed [1000.0, 0.0, 0]
    radius : *radius
    power : &power 500
    path: &path "Path.gcode"
  - type : lumped
    initial_position : [0.0, 0.0, 0.0]
    initial_speed : *speed
    radius : *radius
    power : *power
    path: *path
    mdwidth  : *radius
    mdheight : *half_radius
    mddepth: *half_radius
  - initial_position : [0.0, 0.0, 0.0]
    initial_speed : *speed
    radius : *radius
    power : 0.0
    path: *path
# PROPS
el_type : quadrilateral
material_metal : {
  density : 4.3E-06, # kg / mm3
  conductivity : 5.0E-03, # W / mm / K
  specific_heat : 700, # J / kg / K
  #phase_change : {
  #  latent_heat : 350.0E+03,
  #  solidus_temperature : &solidus_temperature 1600.0,
  #  liquidus_temperature : 1650.0
  #}
}
smoothing_cte_phase_change : 0.5
#convection_coeff : 1.0E-00
environment_temperature : 25
# END_ESSENTIAL
petsc_opts_micro: {
  "ksp_error_if_not_converged" : "true",
  "ksp_type" : "gmres",
  "ksp_atol" : 1e-10,
  "ksp_rtol" : 1e-10,
  "pc_type" : "hypre",
}
petsc_opts_macro: {
  "ksp_error_if_not_converged" : "true",
  "ksp_type" : "gmres",
  "ksp_atol" : 1e-10,
  "ksp_rtol" : 1e-10,
  "pc_type" : "hypre",
  "snes_linesearch_type" : "basic",
  "snes_rtol" : 1e-8,
  "snes_atol" : 1e-8,
  #"pc_type" : "lu",
  #"pc_factor_mat_solver_type" : "superlu_dist",
}
petsc_opts_moving: {
  "ksp_error_if_not_converged" : "true",
  "ksp_type" : "gmres",
  "ksp_atol" : 1e-10,
  "ksp_rtol" : 1e-10,
  "pc_type" : "hypre",
  #"snes_linesearch_type" : "basic",
  "snes_rtol" : 1e-8,
  "snes_atol" : 1e-8,
}
#"newtonls" "newtontr" "newtontrdc" "python" "nrichardson" "ksponly"
#"ksptransposeonly" "vinewtonrsls" "vinewtonssls" "ngmres" "qn" "shell" "ngs"
#"ncg" "fas" "ms" "nasm" "anderson" "aspin" "composite" "patch" "newtonal"
petsc_opts_mono_robin: {
  #"snes_type" : "anderson",
  #"snes_linesearch_monitor" : "",
  "snes_linesearch_type" : "bt",
  "snes_linesearch_order" : 1,
  #"snes_linesearch_alpha": 1e-4,
  "snes_linesearch_minlambda" : 1e-2,
  "snes_linesearch_maxstep" : 1e8,
  "snes_linesearch_max_it" : 5,

  "snes_max_it" : 30,
  "ksp_atol" : 1e-09,
  "ksp_rtol" : 1e-09,
  #"snes_stol" : 1e-3,
  #"snes_linesearch_type": "none",
  "ksp_error_if_not_converged" : "true",
  "pc_type" : "fieldsplit",
  "pc_fieldsplit_type" : "additive",
  "ksp_type" : "gmres",
  #"ksp_view" : 100,
  #"pc_fieldsplit_schur_factorization_type" : "full",
  #"fieldsplit_0_pc_type" : "lu",
  #"fieldsplit_0_pc_factor_mat_solver_type" : "superlu_dist",
  #"fieldsplit_1_pc_type" : "lu",
  #"fieldsplit_1_pc_factor_mat_solver_type" : "superlu_dist"
   #"pc_type" : "lu",
   #"pc_factor_mat_solver_type" : "mumps",
}
petsc_opts_macro_chimera: {
  "snes_max_it" : 30,
  "ksp_atol" : 1e-13,
  "ksp_rtol" : 1e-13,
  "snes_linesearch_max_it" : 15,
  "ksp_error_if_not_converged" : "true",
  "ksp_type" : "gmres",
  "pc_type" : "fieldsplit",
}
domain_width: 1.0
width_path_fraction: 0.8
domain_height: 1.0
height_path_fraction: 0.8
els_per_radius: &els_per_radius 4
straight_line : False

max_timesteps: -1
dt : 1.0
driver_type: "robin"
aitken_relaxation: True
initial_condition: False
quadrature_metadata: {}
supg: 1

max_nr_iters: 30
max_ls_iters: 5
post_freq : 8

substepping_parameters: {
  micro_adim_dt: 0.5,
  macro_adim_dt: 8.0,
  max_staggered_iters: 1,
  adim_lens: {
    back_pad : 3,
    front_pad : 3,
    side_pad : 3,
    top_pad : 3,
    bot_pad : 3,
  },
  predictor: {
    theoretical: False,
    enabled :  True,
    source_term : 2,
    nnlinear : True,
  },
  writepos: True,
  only_writepos_macro: False,
  chimera_always_on: False,
  chimera_driver: {
    type: "monolithic",
    gamma_coeff1 : 1.0,
    gamma_coeff2 : 1.0,
  },
  chimera_steadiness_workflow: {
    enabled: True,
    adim_dt_increment : 0.5,
    max_adim_dt: 2.0,
    threshold: 0.05,
    min_steps_at_dt: 2,
    reuse_last_dt : True,
  }
}

moving_domain_params : {
  els_per_radius : *els_per_radius,
  shape : True,
  max_adim_dt : 2,
  adim_front_len : 2,
  adim_side_len : 3,
  adim_bot_len : 2,
  adim_top_len : 2,
}
gamma_quadrature: {
  degree: 2,
}
